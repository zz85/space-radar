<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Space Radar Electrobun POC</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      overflow: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-size: 24px;
      font-weight: 600;
      color: #667eea;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 14px;
      color: #666;
    }

    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 13px;
      color: #666;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stat-value {
      font-weight: 600;
      color: #667eea;
    }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .canvas-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      padding: 20px;
      max-width: 800px;
      max-height: 800px;
    }

    canvas {
      display: block;
      border-radius: 5px;
    }

    .placeholder {
      text-align: center;
      color: #999;
      padding: 100px 40px;
    }

    .placeholder-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .placeholder h2 {
      font-size: 20px;
      margin-bottom: 10px;
      color: #666;
    }

    .placeholder p {
      font-size: 14px;
      line-height: 1.6;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      background: #f0f9ff;
      border-left: 4px solid #667eea;
      border-radius: 4px;
      font-size: 13px;
    }

    .error {
      background: #fef2f2;
      border-left-color: #ef4444;
      color: #991b1b;
    }

    .success {
      background: #f0fdf4;
      border-left-color: #22c55e;
      color: #166534;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸŒŒ Space Radar Electrobun POC</h1>
      <p class="subtitle">Proof-of-Concept: Disk visualization with Bun runtime</p>
      
      <div class="controls">
        <input 
          type="text" 
          id="pathInput" 
          placeholder="Enter path to scan (e.g., /tmp or C:\Users)"
          value="/tmp"
        />
        <button id="scanBtn">Scan Directory</button>
      </div>

      <div class="stats" id="stats" style="display: none;">
        <div class="stat">
          <span>Files:</span>
          <span class="stat-value" id="fileCount">0</span>
        </div>
        <div class="stat">
          <span>Directories:</span>
          <span class="stat-value" id="dirCount">0</span>
        </div>
        <div class="stat">
          <span>Total Size:</span>
          <span class="stat-value" id="totalSize">0 B</span>
        </div>
        <div class="stat">
          <span>Time:</span>
          <span class="stat-value" id="scanTime">0s</span>
        </div>
      </div>

      <div id="status" style="display: none;"></div>
    </header>

    <main>
      <div class="canvas-container" id="canvasContainer">
        <div class="placeholder">
          <div class="placeholder-icon">ðŸ“Š</div>
          <h2>Ready to scan</h2>
          <p>
            This POC demonstrates Space Radar with Electrobun/Bun.<br>
            Enter a directory path above and click "Scan Directory" to visualize disk usage.
          </p>
          <p style="margin-top: 20px; font-size: 12px; color: #999;">
            <strong>Note:</strong> This is a browser-based demo. The actual Electrobun app would use native APIs.
          </p>
        </div>
      </div>
    </main>
  </div>

  <script type="module">
    // This would be the actual UI code in Electrobun
    // For demo purposes, we'll simulate the scanner output

    const pathInput = document.getElementById('pathInput');
    const scanBtn = document.getElementById('scanBtn');
    const stats = document.getElementById('stats');
    const status = document.getElementById('status');
    const canvasContainer = document.getElementById('canvasContainer');

    // Sample data structure (would come from Bun scanner in real app)
    const sampleData = {
      name: 'tmp',
      path: '/tmp',
      size: 250880,
      isDirectory: true,
      children: [
        {
          name: 'node-compile-cache',
          path: '/tmp/node-compile-cache',
          size: 250880,
          isDirectory: true,
          children: []
        },
        {
          name: 'logs',
          path: '/tmp/logs',
          size: 1024,
          isDirectory: true,
          children: [
            { name: 'app.log', path: '/tmp/logs/app.log', size: 512, isDirectory: false },
            { name: 'error.log', path: '/tmp/logs/error.log', size: 512, isDirectory: false }
          ]
        },
        {
          name: 'cache',
          path: '/tmp/cache',
          size: 2048,
          isDirectory: true,
          children: []
        }
      ]
    };

    scanBtn.addEventListener('click', async () => {
      const path = pathInput.value.trim();
      if (!path) {
        showStatus('Please enter a path', 'error');
        return;
      }

      // Show scanning status
      scanBtn.disabled = true;
      showStatus('Scanning... (simulated)', '');
      stats.style.display = 'none';

      // Simulate scan delay
      await new Promise(resolve => setTimeout(resolve, 1000));

      // In real app, this would call Bun scanner via RPC
      // For demo, use sample data
      const result = sampleData;

      // Update stats
      const fileCount = countFiles(result);
      const dirCount = countDirs(result);
      
      document.getElementById('fileCount').textContent = fileCount.toLocaleString();
      document.getElementById('dirCount').textContent = dirCount.toLocaleString();
      document.getElementById('totalSize').textContent = formatBytes(result.size);
      document.getElementById('scanTime').textContent = '0.01s';
      
      stats.style.display = 'flex';
      showStatus('Scan complete! Rendering visualization...', 'success');

      // Render sunburst
      setTimeout(() => {
        renderSunburst(result);
        showStatus('âœ“ Visualization complete', 'success');
        scanBtn.disabled = false;
      }, 500);
    });

    function countFiles(node) {
      if (!node.children) return node.isDirectory ? 0 : 1;
      return node.children.reduce((sum, child) => sum + countFiles(child), 0);
    }

    function countDirs(node) {
      if (!node.children) return node.isDirectory ? 1 : 0;
      return 1 + node.children.reduce((sum, child) => sum + countDirs(child), 0);
    }

    function formatBytes(bytes) {
      const units = ['B', 'KB', 'MB', 'GB', 'TB'];
      let size = bytes;
      let i = 0;
      while (size >= 1024 && i < units.length - 1) {
        size /= 1024;
        i++;
      }
      return size.toFixed(2) + ' ' + units[i];
    }

    function showStatus(message, type = '') {
      status.textContent = message;
      status.className = 'status ' + type;
      status.style.display = 'block';
    }

    function renderSunburst(data) {
      // Clear placeholder
      canvasContainer.innerHTML = '';

      // Create canvas
      const canvas = document.createElement('canvas');
      canvas.width = 600;
      canvas.height = 600;
      canvasContainer.appendChild(canvas);

      // Simple sunburst rendering
      const ctx = canvas.getContext('2d');
      const centerX = 300;
      const centerY = 300;
      const maxRadius = 280;
      const colors = ['#a1c9f4', '#ffb482', '#8de5a1', '#ff9f9b', '#d0bbff', '#debb9b'];

      function drawNode(node, startAngle, endAngle, innerRadius, outerRadius, depth) {
        const color = colors[depth % colors.length];
        
        // Draw arc
        ctx.beginPath();
        ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);
        ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Draw children
        if (node.children && node.children.length > 0) {
          const totalSize = node.size;
          let currentAngle = startAngle;
          const radiusStep = 100;
          const childInner = outerRadius;
          const childOuter = Math.min(outerRadius + radiusStep, maxRadius);

          for (const child of node.children) {
            const angleSize = ((endAngle - startAngle) * child.size) / totalSize;
            const childEnd = currentAngle + angleSize;
            drawNode(child, currentAngle, childEnd, childInner, childOuter, depth + 1);
            currentAngle = childEnd;
          }
        }
      }

      // Draw center circle
      ctx.beginPath();
      ctx.arc(centerX, centerY, 80, 0, Math.PI * 2);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
      ctx.strokeStyle = '#cccccc';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Draw center text
      ctx.fillStyle = '#333';
      ctx.font = 'bold 16px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(formatBytes(data.size), centerX, centerY);

      // Draw the tree
      drawNode(data, 0, Math.PI * 2, 80, 180, 0);
    }
  </script>
</body>
</html>
